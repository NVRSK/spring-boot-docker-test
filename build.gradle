plugins {
	id 'org.springframework.boot' version '2.6.6'
	id 'io.spring.dependency-management' version '1.0.11.RELEASE'

	// to pack the image using 'docker'
	id "com.palantir.docker" version "0.32.0"

	// to run the image using 'dockerRun'
	id "com.palantir.docker-run" version "0.32.0"
	id 'java'
	id 'idea'
}

group = 'com.bnpp.examples'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '11'

docker {
	dependsOn build
	name "${project.name}:${project.version}"
	files bootJar.archivePath
	buildArgs([JAR_FILE: "${bootJar.archiveName}"])
}

dockerRun {
	name "${project.name}"
	image "${project.name}:${project.version}"
	// host's port <port available outside> : <port of app in the container>
	ports '888:8080'
	// 'true' to remove container after stop
	clean true
}

repositories {
	mavenCentral()
}

dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-web'
	implementation 'org.springframework.boot:spring-boot-starter-test'
	implementation 'org.testcontainers:testcontainers:1.17.1'
	implementation 'org.testcontainers:junit-jupiter:1.17.1'
}

tasks.named('test') {
	useJUnitPlatform()
}
